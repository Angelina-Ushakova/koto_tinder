# КотоТиндер PRO v3.0 - Оффлайн Версия

## Содержание
- [Реализованные функции](#реализованные-функции)
- [Технические особенности](#технические-особенности)
- [Архитектура проекта](#архитектура-проекта)
- [Особенности реализации](#особенности-реализации)
- [Доп функциональность](#доп-функциональность)
- [Демонстрация работы приложения](#демонстрация-работы-приложения)
- [Скачать приложение](#скачать-приложение)

## Реализованные функции

- **Карточки с котиками**: Отображение случайных изображений котиков с указанием породы
- **Жесты**: Возможность "свайпать" карточки влево (дизлайк) или вправо (лайк)
- **Кнопки интеракции**: Альтернативные кнопки лайк/дизлайк в нижней части экрана
- **Умный счетчик лайков**: Отображение реального количества лайкнутых котиков с мгновенным обновлением
- **Детальный просмотр**: Экран с подробной информацией о породе при нажатии на карточку
- **Внешние ссылки**: Интеграция с Wikipedia для получения дополнительной информации
- **Список лайкнутых котиков**: Отдельный экран со всеми котиками, получившими лайк
- **Фильтрация по породе**: Возможность фильтровать лайкнутые карточки по породе котиков
- **Удаление из избранного**: Возможность удаления котиков из списка лайкнутых свайпом влево
- **Постоянное хранение лайков**: Лайки сохраняются между запусками приложения в SQLite базе данных
- **Оффлайн-режим**: Работа без интернета с отображением ранее загруженных котиков
- **Кэширование изображений**: Изображения сохраняются локально и доступны без сети
- **Неблокирующие уведомления о сети**: Snackbar сообщения о статусе подключения
- **Индикаторы загрузки**: Отображение прогресс-индикаторов при загрузке данных
- **Анимации**: Плавные анимации при свайпе и визуальная обратная связь

## Технические особенности

### Статический анализ кода
- **Форматирование**: Код отформатирован с помощью `dart format`
- **Линтинг**: В `analysis_options.yaml` настроены правила для поддержания качества кода
- **Анализ**: Команда `flutter analyze` выполняется без ошибок

### Архитектурные решения
- **Clean Architecture**: Строгое разделение на слои Data, Domain и Presentation
- **Управление состоянием**: Использование Flutter Bloc для всех экранов
- **Внедрение зависимостей**: Реализация DI с помощью библиотеки get_it
- **Репозитории**: Абстракция для доступа к данным через интерфейсы
- **Use Cases**: Бизнес-логика вынесена в отдельные классы использования

### Локальное хранение данных
- **SQLite база данных**: Надежное хранение лайкнутых котиков с возможностью фильтрации
- **SharedPreferences**: Сохранение пользовательских настроек (тема, счетчики)
- **Кэширование котиков**: Локальное хранение данных о котиках для оффлайн-доступа
- **Автоматическая очистка**: Управление размером кэша для оптимизации памяти

### Кэширование изображений
- **Cached Network Image**: Основное кэширование изображений с fallback
- **Enhanced Image Cache Service**: Продвинутое кэширование с MD5-хэшированием
- **Двухуровневая система**: Кэш в памяти и на диске
- **Управление размером**: Автоматическое удаление старых файлов (до 200 изображений)

### Мониторинг сети
- **Connectivity Plus**: Отслеживание состояния подключения к интернету
- **Snackbar уведомления**: Неблокирующие сообщения о потере/восстановлении сети
- **Автоматическое переключение**: Seamless переход между онлайн/оффлайн режимами
- **Визуальные индикаторы**: Отображение статуса недоступности контента

### Тестирование
- **Unit-тесты на Bloc**: Тестирование HomeBloc и LikedCatsBloc на операции лайков и дизлайков
- **Мокирование UseCase'ов**: Использование Mockito для изоляции тестов стейт-менеджеров
- **Widget тесты**: Базовое тестирование пользовательского интерфейса
- **Покрытие основных сценариев**: Тестирование ключевых пользовательских операций

### Реализация требований ДЗ3

1. **Оффлайн-режим**
   - Приложение отображает ранее загруженных котиков без интернета
   - Fallback-система автоматически переключается на локальный кэш
   - Все функции работают оффлайн (просмотр, лайки, фильтрация)

2. **Постоянное хранение лайков**
   - Лайки сохраняются в SQLite базе данных между запусками приложения
   - Дата и время лайка записываются для каждого котика
   - Счетчик отображает реальное количество лайкнутых котиков

3. **Кэширование изображений**
   - Все изображения кэшируются локально через cached_network_image
   - Дополнительное кэширование через Enhanced Image Cache Service
   - Изображения доступны для просмотра без интернета

4. **Неблокирующие уведомления о сети**
   - Snackbar сообщения не мешают использованию приложения
   - Автоматические уведомления о потере и восстановлении сети
   - Визуальные индикаторы недоступности контента

5. **Качественное тестирование**
   - Unit-тесты покрывают основные стейт-менеджеры (HomeBloc, LikedCatsBloc)
   - Mockito используется для мокирования UseCase'ов в тестах
   - Тесты проверяют ключевые операции лайков, дизлайков и управления списком
   - Все написанные тесты успешно проходят

## Архитектура проекта

- **/lib/data/** - Реализация доступа к данным
  - **/datasources/** - Источники данных (API, Database, Cache, Connectivity)
  - **/repositories/** - Конкретные реализации репозиториев
  
- **/lib/domain/** - Бизнес-логика приложения
  - **/entities/** - Бизнес-модели
  - **/repositories/** - Интерфейсы репозиториев
  - **/usecases/** - Сценарии использования
  
- **/lib/presentation/** - Пользовательский интерфейс
  - **/blocs/** - Компоненты управления состоянием (Bloc)
  - **/screens/** - Экраны приложения
  - **/widgets/** - Повторно используемые компоненты интерфейса
  - **/theme/** - Управление темами приложения
  
- **/lib/di/** - Внедрение зависимостей
  - **/service_locator.dart** - Регистрация и доступ к зависимостям

- **/lib/utils/** - Вспомогательные утилиты

- **/test/** - Unit и Widget тесты

## Особенности реализации

### Работа с The Cat API

- **Эффективная загрузка данных**: Использование параметра `limit` для оптимизации количества запросов
- **Фильтрация по породе**: Параметр `has_breeds=1` обеспечивает получение только котиков с информацией о породе
- **Предзагрузка контента**: Асинхронная загрузка следующих партий котиков в фоновом режиме
- **Обработка ошибок**: Детальная обработка различных сетевых исключений с fallback на кэш

### Система кэширования и оффлайн-работа

- **Многоуровневое кэширование**: Кэш в памяти, на диске и в базе данных
- **Fallback-механизм**: Автоматическое переключение на локальные данные при отсутствии сети
- **Enhanced Image Cache Service**: Продвинутое кэширование с MD5-хэшированием URL
- **Нормализация URL**: Предотвращение дублирования кэшированных изображений
- **Управление размером кэша**: Автоматическая очистка старых файлов

### Локальная база данных

- **SQLite через sqflite**: Надежное хранение лайкнутых котиков
- **Структурированные таблицы**: Отдельные таблицы для лайков и кэша
- **Индексы и оптимизация**: Быстрые запросы и фильтрация по породам
- **Миграции схемы**: Возможность обновления структуры базы данных

### Мониторинг состояния сети

- **Connectivity Plus**: Real-time отслеживание подключения
- **Stream подписки**: Реактивное обновление UI при изменении сети
- **Graceful degradation**: Плавная деградация функций при потере сети
- **Восстановление функциональности**: Автоматическое возобновление при восстановлении связи

### Блоки управления состоянием

- **HomeBloc**: Управление состоянием главного экрана с котиками и счетчиком
- **LikedCatsBloc**: Управление состоянием экрана с лайкнутыми котиками и фильтрацией
- **ThemeNotifier**: Управление переключением темы с сохранением в SharedPreferences
- **События и состояния**: Четкое разделение логики обработки событий и отображения состояний

### Анимации и пользовательский опыт

- **Свайп-жесты**: Обработка жестов перетаскивания для лайков и дизлайков
- **Hero переходы**: Плавные анимации при переходе между экранами
- **Визуальная обратная связь**: Цветовые индикаторы действий (зеленый для лайка, красный для дизлайка)
- **Мгновенное обновление**: Счетчик лайков обновляется немедленно при возврате с экрана лайков

## Доп функциональность

- **Переключатель темы**: Кнопка в AppBar для мгновенного переключения между светлой и темной темой
- **Автоматическое сохранение**: Выбор темы сохраняется в SharedPreferences между сессиями
- **Material Design 3**: Современные цветовые схемы для обеих тем
- **Консистентный дизайн**: Тема применяется ко всем экранам и компонентам
- **Адаптивные иконки**: Иконка переключателя меняется в зависимости от текущей темы

### Улучшенная логика счетчика лайков

- **Реальное количество**: Счетчик показывает актуальное количество котиков в списке лайков
- **Мгновенное обновление**: Автоматическое обновление при возврате с экрана лайков
- **Синхронизация**: Счетчик всегда соответствует реальному содержимому базы данных

### Технические решения

- **Enhanced Image Cache Service**: Собственная реализация кэширования с MD5-хэшированием
- **Предзагрузка контента**: Интеллектуальная загрузка следующих партий котиков в фоне
- **Graceful degradation**: Умная система деградации функций при проблемах с сетью

## Демонстрация работы приложения

### Основная функциональность и управление лайками

<table>
  <tr>
    <td>
      <img src="https://raw.githubusercontent.com/Angelina-Ushakova/koto_tinder/hw3/koto_tinder/assets/demo/likes.gif" width="250"/>
      <br><b>Лайки и их счетчик</b>
    </td>
    <td>
      <img src="https://raw.githubusercontent.com/Angelina-Ushakova/koto_tinder/hw3/koto_tinder/assets/demo/theme.gif" width="250"/>
      <br><b>Переключение темы</b>
    </td>
  </tr>
</table>

### Оффлайн-режим и уведомления о сети

<table>
  <tr>
    <td>
      <img src="https://raw.githubusercontent.com/Angelina-Ushakova/koto_tinder/hw3/koto_tinder/assets/demo/internet.gif" width="250"/>
      <br><b>Оффлайн-режим</b>
    </td>
  </tr>
</table>

*Демонстрация показывает неблокирующие Snackbar уведомления о статусе сети и переключение в оффлайн-режим*
- Файлы .gif очень тяжёлые, поэтому демонстрация выше может загружаться не быстро..
  
## Скачать приложение

[Скачать APK v3.0.0](https://github.com/Angelina-Ushakova/koto_tinder/releases/download/v3.0.0/koto-tinder-v3.0.0-offline-dark-theme.apk)
